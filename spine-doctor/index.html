<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Spinal Care</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{overflow-x:hidden}
body{background:#050508;color:#fff;font-family:'Inter',sans-serif;overflow-x:hidden}
h1,h2,h3,h4{font-family:'Poppins',sans-serif;text-wrap:balance}
p,li{text-wrap:pretty}

.scroll-spacer{height:600vh;position:relative;pointer-events:none}
#c{position:fixed;inset:0;z-index:1;width:100%;height:100%}
.overlay{position:fixed;inset:0;z-index:10;pointer-events:none;overflow:hidden}

.panel{position:absolute;opacity:0;pointer-events:none;transition:none}

/* Hero */
.hero-panel{inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;opacity:1}
.hero-title{font-size:clamp(2.25rem,1.647rem + 2.57vw,3.938rem);font-weight:700;letter-spacing:-0.02em;line-height:1.1;margin-bottom:16px;background:linear-gradient(135deg,#fff 0%,#a0c4ff 50%,#2dd4a8 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-sub{font-size:clamp(1rem,0.943rem + 0.24vw,1.125rem);color:#94a3b8;font-weight:300;max-width:480px;line-height:1.6}
.scroll-hint{position:absolute;bottom:40px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:8px;color:#4a5568}
.scroll-hint span{font-size:12px;text-transform:uppercase;letter-spacing:0.15em;font-weight:500}
.scroll-hint .material-icons{font-size:20px;animation:hintBounce 2.1s ease-in-out infinite}
@keyframes hintBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(6px)}}

/* Region panels */
.panel-region{top:50%;width:380px;max-width:85vw}
.panel-left{left:5%;transform:translateY(-50%) translateX(-50px)}
.panel-right{right:5%;transform:translateY(-50%) translateX(50px)}

.panel-card{background:rgba(255,255,255,0.03);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.06);border-radius:20px;padding:clamp(24px,3vw,40px)}
.panel-cervical .panel-card{border-color:rgba(74,158,255,0.12);box-shadow:0 0 40px rgba(74,158,255,0.04)}
.panel-thoracic .panel-card{border-color:rgba(59,130,246,0.12);box-shadow:0 0 40px rgba(59,130,246,0.04)}
.panel-lumbar .panel-card{border-color:rgba(45,212,168,0.12);box-shadow:0 0 40px rgba(45,212,168,0.04)}

.region-label{display:inline-block;font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:0.2em;padding:4px 12px;border-radius:20px;margin-bottom:16px}
.panel-cervical .region-label{color:#4a9eff;background:rgba(74,158,255,0.1)}
.panel-thoracic .region-label{color:#3b82f6;background:rgba(59,130,246,0.1)}
.panel-lumbar .region-label{color:#2dd4a8;background:rgba(45,212,168,0.1)}

.panel-card h2{font-size:clamp(1.5rem,1.155rem + 1.47vw,2.25rem);font-weight:700;margin-bottom:4px}
.panel-subtitle{font-size:13px;color:#64748b;margin-bottom:16px;font-weight:400}
.panel-desc{font-size:clamp(0.875rem,0.85rem + 0.12vw,0.938rem);color:#94a3b8;line-height:1.7;margin-bottom:20px}

.condition-list{list-style:none;display:flex;flex-direction:column;gap:10px;margin-bottom:24px}
.condition-list li{display:flex;align-items:center;gap:10px;font-size:14px;color:#cbd5e1}
.condition-list .material-icons{font-size:16px}
.panel-cervical .condition-list .material-icons{color:#4a9eff}
.panel-thoracic .condition-list .material-icons{color:#3b82f6}
.panel-lumbar .condition-list .material-icons{color:#2dd4a8}

.stat-block{display:flex;align-items:baseline;gap:8px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.06)}
.stat-number{font-family:'Poppins',sans-serif;font-size:clamp(1.875rem,1.5rem + 1.5vw,2.5rem);font-weight:700}
.panel-cervical .stat-number{color:#4a9eff}
.panel-thoracic .stat-number{color:#3b82f6}
.panel-lumbar .stat-number{color:#2dd4a8}
.stat-label{font-size:13px;color:#64748b}

/* Services */
.services-panel{inset:0;display:flex;align-items:center;justify-content:center}
.services-wrap{display:flex;flex-direction:column;align-items:center;width:100%;max-width:1100px;padding:0 24px}
.services-heading{font-size:clamp(1.125rem,0.95rem + 0.74vw,1.5rem);font-weight:300;color:#64748b;text-transform:uppercase;letter-spacing:0.15em;margin-bottom:32px;text-align:center}
.services-grid{display:grid;grid-template-columns:1fr 160px 1fr;gap:20px;width:100%}
.service-card{background:rgba(255,255,255,0.03);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.06);border-radius:16px;padding:24px;text-align:center}
.service-card .material-icons{font-size:28px;color:#00d4ff;margin-bottom:12px}
.service-card h3{font-size:15px;font-weight:600;margin-bottom:6px}
.service-card p{font-size:13px;color:#94a3b8;line-height:1.5}
.service-spacer{pointer-events:none}

/* CTA */
.cta-panel{inset:0;display:flex;align-items:center;justify-content:center;text-align:center}
.cta-wrap{max-width:500px;padding:0 24px}
.cta-wrap h2{font-size:clamp(1.875rem,1.357rem + 2.21vw,3rem);font-weight:700;margin-bottom:12px;background:linear-gradient(135deg,#4a9eff,#2dd4a8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.cta-wrap p{color:#94a3b8;font-size:clamp(0.938rem,0.909rem + 0.12vw,1rem);line-height:1.7;margin-bottom:28px}
.cta-btn{display:inline-block;padding:14px 36px;background:linear-gradient(135deg,#4a9eff,#2dd4a8);color:#050508;font-family:'Poppins',sans-serif;font-weight:600;font-size:15px;border:none;border-radius:50px;cursor:pointer;text-decoration:none;transition:transform 0.3s,box-shadow 0.3s;pointer-events:auto}
.cta-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(74,158,255,0.3)}
.cta-contact{display:flex;justify-content:center;gap:32px;margin-top:24px;flex-wrap:wrap}
.cta-contact-item{display:flex;align-items:center;gap:8px;color:#64748b;font-size:13px}
.cta-contact-item .material-icons{font-size:16px;color:#4a9eff}

/* Nav dots */
.nav-dots{position:fixed;right:24px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:18px;z-index:50}
.nav-dots::before{content:'';position:absolute;left:50%;top:0;bottom:0;width:1px;background:rgba(255,255,255,0.06);transform:translateX(-50%);z-index:-1}
.dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.2);cursor:pointer;transition:all 0.3s;position:relative}
.dot.active{background:#00d4ff;border-color:#00d4ff;box-shadow:0 0 12px rgba(0,212,255,0.5);transform:scale(1.3)}
.dot-label{position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:10px;text-transform:uppercase;letter-spacing:0.1em;color:#4a5568;white-space:nowrap;opacity:0;transition:opacity 0.3s;pointer-events:none}
.dot:hover .dot-label,.dot.active .dot-label{opacity:1;color:#94a3b8}

/* Progress */
.progress-track{position:fixed;left:16px;top:12%;bottom:12%;width:2px;background:rgba(255,255,255,0.04);z-index:50;border-radius:1px}
.progress-fill{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:1px;background:linear-gradient(to bottom,#4a9eff,#3b82f6,#2dd4a8);transform:scaleY(0);transform-origin:top}

@media(max-width:768px){
  .panel-left,.panel-right{left:5%;right:5%;top:auto;bottom:6%;width:auto;max-width:none;transform:translateY(40px)}
  .services-grid{grid-template-columns:1fr 1fr;gap:12px}
  .service-spacer{display:none}
  .nav-dots{right:12px;gap:14px}
  .dot-label{display:none}
  .progress-track{display:none}
}
@media(max-width:480px){
  .services-grid{grid-template-columns:1fr}
  .cta-contact{flex-direction:column;align-items:center;gap:16px}
}
@media(prefers-reduced-motion:reduce){
  .scroll-hint{display:none}
  .panel{opacity:1!important;transform:none!important;pointer-events:auto!important;position:relative!important}
  .overlay{position:relative!important;overflow:visible!important}
  .scroll-spacer{display:none!important}
  #c{position:relative!important;height:50vh!important}
}
</style>
</head>
<body>

<div class="scroll-spacer"></div>
<canvas id="c"></canvas>

<div class="overlay">
  <div class="panel hero-panel">
    <h1 class="hero-title">Advanced Spinal Care</h1>
    <p class="hero-sub">Precision diagnostics. Expert treatment. Complete recovery. Scroll to explore the spine and discover our specialized care.</p>
    <div class="scroll-hint">
      <span>Scroll to explore</span>
      <span class="material-icons">expand_more</span>
    </div>
  </div>

  <div class="panel panel-region panel-cervical panel-left">
    <div class="panel-card">
      <span class="region-label">Cervical Region</span>
      <h2>Neck & Upper Spine</h2>
      <p class="panel-subtitle">C1 - C7 Vertebrae</p>
      <p class="panel-desc">Expert treatment for conditions affecting the cervical spine, restoring range of motion and relieving chronic pain.</p>
      <ul class="condition-list">
        <li><span class="material-icons">check_circle</span>Herniated Disc Treatment</li>
        <li><span class="material-icons">check_circle</span>Cervical Stenosis</li>
        <li><span class="material-icons">check_circle</span>Whiplash & Neck Injuries</li>
      </ul>
      <div class="stat-block">
        <span class="stat-number">97%</span>
        <span class="stat-label">Patient Satisfaction</span>
      </div>
    </div>
  </div>

  <div class="panel panel-region panel-thoracic panel-right">
    <div class="panel-card">
      <span class="region-label">Thoracic Region</span>
      <h2>Mid-Back Spine</h2>
      <p class="panel-subtitle">T1 - T12 Vertebrae</p>
      <p class="panel-desc">Specialized care for thoracic conditions, from postural correction to complex deformities using advanced diagnostics.</p>
      <ul class="condition-list">
        <li><span class="material-icons">check_circle</span>Kyphosis Correction</li>
        <li><span class="material-icons">check_circle</span>Compression Fractures</li>
        <li><span class="material-icons">check_circle</span>Thoracic Disc Disease</li>
      </ul>
      <div class="stat-block">
        <span class="stat-number">2,500+</span>
        <span class="stat-label">Procedures Performed</span>
      </div>
    </div>
  </div>

  <div class="panel panel-region panel-lumbar panel-left">
    <div class="panel-card">
      <span class="region-label">Lumbar Region</span>
      <h2>Lower Back Spine</h2>
      <p class="panel-subtitle">L1 - L5 Vertebrae</p>
      <p class="panel-desc">Comprehensive solutions for the most common source of back pain, from conservative therapy to minimally invasive surgery.</p>
      <ul class="condition-list">
        <li><span class="material-icons">check_circle</span>Sciatica & Radiculopathy</li>
        <li><span class="material-icons">check_circle</span>Spinal Stenosis</li>
        <li><span class="material-icons">check_circle</span>Degenerative Disc Disease</li>
      </ul>
      <div class="stat-block">
        <span class="stat-number">92%</span>
        <span class="stat-label">Return to Full Activity</span>
      </div>
    </div>
  </div>

  <div class="panel services-panel">
    <div class="services-wrap">
      <span class="services-heading">Our Specializations</span>
      <div class="services-grid">
        <div class="service-card"><span class="material-icons">biotech</span><h3>Advanced Diagnostics</h3><p>MRI, CT, and nerve conduction studies for precise diagnosis</p></div>
        <div class="service-card"><span class="material-icons">healing</span><h3>Conservative Care</h3><p>Physical therapy, injections, and pain management programs</p></div>
        <div class="service-spacer"></div>
        <div class="service-card"><span class="material-icons">precision_manufacturing</span><h3>Minimally Invasive</h3><p>Small incision techniques with faster recovery times</p></div>
        <div class="service-card"><span class="material-icons">medical_services</span><h3>Spinal Surgery</h3><p>Fusion, decompression, and full reconstruction</p></div>
      </div>
    </div>
  </div>

  <div class="panel cta-panel">
    <div class="cta-wrap">
      <h2>Begin Your Recovery</h2>
      <p>Schedule a consultation with our spine specialists and take the first step toward a pain-free life.</p>
      <a href="#" class="cta-btn">Book Consultation</a>
      <div class="cta-contact">
        <div class="cta-contact-item"><span class="material-icons">call</span>(555) 234-5678</div>
        <div class="cta-contact-item"><span class="material-icons">location_on</span>Austin, TX</div>
      </div>
    </div>
  </div>
</div>

<nav class="nav-dots">
  <div class="dot active" data-idx="0"><span class="dot-label">Home</span></div>
  <div class="dot" data-idx="1"><span class="dot-label">Cervical</span></div>
  <div class="dot" data-idx="2"><span class="dot-label">Thoracic</span></div>
  <div class="dot" data-idx="3"><span class="dot-label">Lumbar</span></div>
  <div class="dot" data-idx="4"><span class="dot-label">Services</span></div>
  <div class="dot" data-idx="5"><span class="dot-label">Contact</span></div>
</nav>

<div class="progress-track"><div class="progress-fill"></div></div>

<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lenis@1/dist/lenis.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
(function(){
  if(window.matchMedia('(prefers-reduced-motion:reduce)').matches) return;
  gsap.registerPlugin(ScrollTrigger);

  var canvas = document.getElementById('c');
  var W = function(){return window.innerWidth};
  var H = function(){return window.innerHeight};
  var renderer = new THREE.WebGLRenderer({canvas:canvas, antialias:true, alpha:true});
  renderer.setSize(W(),H());
  renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));

  var scene = new THREE.Scene();
  var camera = new THREE.PerspectiveCamera(42, W()/H(), 0.1, 100);
  camera.position.set(0, 0, 15);

  scene.add(new THREE.AmbientLight(0x334466, 0.6));
  var keyLight = new THREE.DirectionalLight(0x88bbff, 0.8);
  keyLight.position.set(3, 5, 8);
  scene.add(keyLight);
  var rimLight = new THREE.DirectionalLight(0x2dd4a8, 0.3);
  rimLight.position.set(-4, -3, 6);
  scene.add(rimLight);
  var regionLight = new THREE.PointLight(0x4a9eff, 0, 8);
  regionLight.position.set(0, 0, 3);
  scene.add(regionLight);

  var spineCurve = new THREE.CatmullRomCurve3([
    new THREE.Vector3(0, -5.5, 0),
    new THREE.Vector3(0, -4, 0.7),
    new THREE.Vector3(0, -1.5, -0.25),
    new THREE.Vector3(0, 2.2, 0.4),
    new THREE.Vector3(0, 4.2, 0.15)
  ]);

  function vShape(bw, bd, tw, sl, pd){
    var s = new THREE.Shape();
    s.moveTo(-bw, bd*0.15);
    s.bezierCurveTo(-bw*1.1, bd*0.7, -bw*0.35, bd*1.1, 0, bd*1.1);
    s.bezierCurveTo(bw*0.35, bd*1.1, bw*1.1, bd*0.7, bw, bd*0.15);
    s.lineTo(bw*0.75, -pd*0.12);
    s.lineTo(bw*0.55, -pd*0.28);
    s.lineTo(tw, -pd*0.22);
    s.lineTo(tw*1.05, -pd*0.32);
    s.lineTo(tw*0.85, -pd*0.42);
    s.lineTo(bw*0.48, -pd*0.45);
    s.bezierCurveTo(bw*0.3,-pd*0.7, bw*0.12,-pd*0.9, 0.04,-pd-sl);
    s.lineTo(0, -pd-sl-0.04);
    s.lineTo(-0.04, -pd-sl);
    s.bezierCurveTo(-bw*0.12,-pd*0.9, -bw*0.3,-pd*0.7, -bw*0.48,-pd*0.45);
    s.lineTo(-tw*0.85, -pd*0.42);
    s.lineTo(-tw*1.05, -pd*0.32);
    s.lineTo(-tw, -pd*0.22);
    s.lineTo(-bw*0.55, -pd*0.28);
    s.lineTo(-bw*0.75, -pd*0.12);
    s.lineTo(-bw, bd*0.15);
    return s;
  }

  var spineGrp = new THREE.Group();
  scene.add(spineGrp);
  var vMeshes = [];
  var zUp = new THREE.Vector3(0,0,1);

  var regions = [
    {name:'cervical', count:7,  tS:0.75, tE:0.97, bw:0.28, bd:0.18, tw:0.38, sl:0.12, pd:0.22, h:0.12, col:0x4a9eff},
    {name:'thoracic', count:10, tS:0.30, tE:0.72, bw:0.34, bd:0.24, tw:0.48, sl:0.30, pd:0.26, h:0.16, col:0x3b82f6},
    {name:'lumbar',   count:5,  tS:0.05, tE:0.27, bw:0.48, bd:0.32, tw:0.42, sl:0.16, pd:0.24, h:0.24, col:0x2dd4a8}
  ];

  regions.forEach(function(r){
    for(var i=0; i<r.count; i++){
      var t = r.tS + (r.tE - r.tS) * (i / (r.count - 1 || 1));
      var pos = spineCurve.getPointAt(t);
      var tan = spineCurve.getTangentAt(t);

      var shape = vShape(r.bw, r.bd, r.tw, r.sl, r.pd);
      var geo = new THREE.ExtrudeGeometry(shape, {
        depth:r.h, bevelEnabled:true, bevelThickness:0.02, bevelSize:0.02, bevelSegments:2
      });
      geo.translate(0, 0, -r.h/2);

      var mat = new THREE.MeshPhongMaterial({
        color:r.col, emissive:r.col, emissiveIntensity:0.08,
        transparent:true, opacity:0.5, shininess:60,
        side:THREE.DoubleSide, depthWrite:false
      });
      var mesh = new THREE.Mesh(geo, mat);
      mesh.userData = {region:r.name};

      var q = new THREE.Quaternion().setFromUnitVectors(zUp, tan.clone().normalize());
      mesh.quaternion.copy(q);
      mesh.position.copy(pos);

      var edges = new THREE.EdgesGeometry(geo, 22);
      var eMat = new THREE.LineBasicMaterial({color:r.col, transparent:true, opacity:0.2});
      mesh.add(new THREE.LineSegments(edges, eMat));

      spineGrp.add(mesh);
      vMeshes.push(mesh);

      if(i < r.count - 1){
        var tNext = r.tS + (r.tE - r.tS) * ((i+1) / (r.count - 1 || 1));
        var midT = (t + tNext) / 2;
        var dPos = spineCurve.getPointAt(midT);
        var dTan = spineCurve.getTangentAt(midT);
        var dGeo = new THREE.CylinderGeometry(r.bw*0.7, r.bw*0.7, r.h*0.35, 12);
        var dMat = new THREE.MeshPhongMaterial({
          color:0x1a3352, emissive:0x0a1a2c, emissiveIntensity:0.05,
          transparent:true, opacity:0.3
        });
        var disc = new THREE.Mesh(dGeo, dMat);
        var dq = new THREE.Quaternion().setFromUnitVectors(new THREE.Vector3(0,1,0), dTan.clone().normalize());
        disc.quaternion.copy(dq);
        disc.position.copy(dPos);
        spineGrp.add(disc);
      }
    }
  });

  /* Nerve particles */
  var pCount = 300;
  var pGeo = new THREE.BufferGeometry();
  var pPos = new Float32Array(pCount*3);
  var pData = [];
  for(var i=0;i<pCount;i++){
    var pt0 = Math.random();
    var spd = 0.0008 + Math.random()*0.0025;
    var ox = (Math.random()-0.5)*0.25;
    var oz = (Math.random()-0.5)*0.25;
    pData.push({t:pt0, speed:spd, ox:ox, oz:oz});
    var pp = spineCurve.getPointAt(pt0);
    pPos[i*3]=pp.x+ox; pPos[i*3+1]=pp.y; pPos[i*3+2]=pp.z+oz;
  }
  pGeo.setAttribute('position', new THREE.BufferAttribute(pPos,3));
  var pMat = new THREE.PointsMaterial({
    color:0x00d4ff, size:0.04, transparent:true, opacity:0.6,
    blending:THREE.AdditiveBlending, depthWrite:false
  });
  var particleMesh = new THREE.Points(pGeo, pMat);
  spineGrp.add(particleMesh);

  /* Ambient dust */
  var dCount = 120;
  var dGeo2 = new THREE.BufferGeometry();
  var dArr = new Float32Array(dCount*3);
  var dustD = [];
  for(var j=0;j<dCount;j++){
    var dx=(Math.random()-0.5)*16, dy=(Math.random()-0.5)*14, dz=(Math.random()-0.5)*10;
    dArr[j*3]=dx; dArr[j*3+1]=dy; dArr[j*3+2]=dz;
    dustD.push({sx:Math.random()*0.002, sy:Math.random()*0.001});
  }
  dGeo2.setAttribute('position', new THREE.BufferAttribute(dArr,3));
  var dustMesh = new THREE.Points(dGeo2, new THREE.PointsMaterial({
    color:0x334466, size:0.03, transparent:true, opacity:0.3,
    blending:THREE.AdditiveBlending, depthWrite:false
  }));
  scene.add(dustMesh);

  /* Scroll State */
  var S = {camY:0, camZ:15, lookY:0, rotY:0, cervGlow:0, thorGlow:0, lumbGlow:0, lightY:0, lightI:0};

  /* Master Timeline */
  var tl = gsap.timeline({
    scrollTrigger:{trigger:'.scroll-spacer', start:'top top', end:'bottom bottom', scrub:0.7}
  });

  /* HERO 0-10 */
  tl.to(S, {rotY:0.3, duration:10}, 0);
  /* HERO FADE 9-13 */
  tl.to('.hero-panel', {opacity:0, duration:4}, 9);
  /* CERVICAL ZOOM 10-18 */
  tl.to(S, {camY:3.5, camZ:9.5, lookY:3, cervGlow:1, lightY:3.5, lightI:2, rotY:0.8, duration:8}, 10);
  /* CERVICAL PANEL 15-20 */
  tl.to('.panel-cervical', {opacity:1, x:0, duration:5}, 15);
  /* CERVICAL HOLD 18-28 */
  tl.to(S, {rotY:1.1, duration:10}, 18);
  /* CERVICAL OUT 28-31 + THORACIC ZOOM 28-36 */
  tl.to('.panel-cervical', {opacity:0, x:-50, duration:3}, 28);
  tl.to(S, {camY:-0.5, lookY:-1, cervGlow:0, thorGlow:1, lightY:-0.5, rotY:1.6, duration:8}, 28);
  /* THORACIC PANEL 33-38 */
  tl.to('.panel-thoracic', {opacity:1, x:0, duration:5}, 33);
  /* THORACIC HOLD 36-46 */
  tl.to(S, {rotY:2.0, duration:10}, 36);
  /* THORACIC OUT 46-49 + LUMBAR ZOOM 46-54 */
  tl.to('.panel-thoracic', {opacity:0, x:50, duration:3}, 46);
  tl.to(S, {camY:-3.5, lookY:-4, thorGlow:0, lumbGlow:1, lightY:-3.5, rotY:2.5, duration:8}, 46);
  /* LUMBAR PANEL 51-56 */
  tl.to('.panel-lumbar', {opacity:1, x:0, duration:5}, 51);
  /* LUMBAR HOLD 54-64 */
  tl.to(S, {rotY:2.9, duration:10}, 54);
  /* LUMBAR OUT 64-67 + PULL BACK 64-72 */
  tl.to('.panel-lumbar', {opacity:0, x:-50, duration:3}, 64);
  tl.to(S, {camY:0, camZ:17, lookY:0, lumbGlow:0.25, cervGlow:0.25, thorGlow:0.25, lightI:0.5, rotY:3.3, duration:8}, 64);
  /* SERVICES IN 70-76 */
  tl.to('.services-panel', {opacity:1, duration:6}, 70);
  /* SERVICES HOLD 72-82 */
  tl.to(S, {rotY:3.8, duration:10}, 72);
  /* SERVICES OUT 82-86 + CTA TRANSITION 82-90 */
  tl.to('.services-panel', {opacity:0, duration:4}, 82);
  tl.to(S, {rotY:4.2, camZ:14, cervGlow:0.4, thorGlow:0.4, lumbGlow:0.4, lightI:1.5, duration:8}, 82);
  /* CTA IN 87-92 */
  tl.to('.cta-panel', {opacity:1, duration:5}, 87);
  /* CTA HOLD 90-100 */
  tl.to(S, {rotY:4.7, duration:10}, 90);
  tl.set({},{}, 100);

  /* Nav dots + progress */
  var dots = document.querySelectorAll('.dot');
  var progressFill = document.querySelector('.progress-fill');
  var breaks = [0, 0.17, 0.33, 0.50, 0.67, 0.83];

  ScrollTrigger.create({
    trigger:'.scroll-spacer', start:'top top', end:'bottom bottom',
    onUpdate: function(self){
      var p = self.progress;
      var idx = 0;
      for(var k=breaks.length-1;k>=0;k--){ if(p>=breaks[k]){idx=k;break;} }
      dots.forEach(function(d,i){d.classList.toggle('active',i===idx)});
      progressFill.style.transform = 'scaleY('+p+')';
    }
  });

  /* Lenis */
  var lenis = new Lenis({smoothWheel:true, lerp:0.08});
  lenis.on('scroll', ScrollTrigger.update);
  gsap.ticker.add(function(t){lenis.raf(t*1000)});
  gsap.ticker.lagSmoothing(0);

  var spacer = document.querySelector('.scroll-spacer');
  dots.forEach(function(d){
    d.addEventListener('click', function(){
      var idx = parseInt(d.dataset.idx);
      lenis.scrollTo(breaks[idx] * spacer.scrollHeight);
    });
  });

  /* Mouse */
  var mx=0, my=0;
  document.addEventListener('mousemove', function(e){
    mx=(e.clientX/W()-0.5)*2;
    my=(e.clientY/H()-0.5)*2;
  });

  /* Render loop */
  var autoRot = 0;
  function animate(time){
    requestAnimationFrame(animate);

    camera.position.set(0, S.camY, S.camZ);
    camera.lookAt(0, S.lookY, 0);

    autoRot += 0.001;
    spineGrp.rotation.y = S.rotY + autoRot;
    spineGrp.rotation.x += (my*0.08 - spineGrp.rotation.x)*0.04;
    spineGrp.rotation.z += (mx*0.04 - spineGrp.rotation.z)*0.04;

    vMeshes.forEach(function(m){
      var rn = m.userData.region;
      var g = 0.08;
      if(rn==='cervical') g += S.cervGlow*0.35;
      if(rn==='thoracic') g += S.thorGlow*0.35;
      if(rn==='lumbar')   g += S.lumbGlow*0.35;
      m.material.emissiveIntensity = g;
      m.material.opacity = 0.4 + g*0.5;
      if(m.children[0] && m.children[0].material){
        m.children[0].material.opacity = 0.15 + g*0.3;
      }
    });

    regionLight.position.set(0, S.lightY, 3);
    regionLight.intensity = S.lightI;
    if(S.cervGlow>=S.thorGlow && S.cervGlow>=S.lumbGlow) regionLight.color.setHex(0x4a9eff);
    else if(S.thorGlow>=S.lumbGlow) regionLight.color.setHex(0x3b82f6);
    else regionLight.color.setHex(0x2dd4a8);

    var pa = particleMesh.geometry.attributes.position.array;
    for(var i=0;i<pCount;i++){
      pData[i].t = (pData[i].t + pData[i].speed) % 1;
      var pt = spineCurve.getPointAt(pData[i].t);
      pa[i*3]=pt.x+pData[i].ox; pa[i*3+1]=pt.y; pa[i*3+2]=pt.z+pData[i].oz;
    }
    particleMesh.geometry.attributes.position.needsUpdate = true;

    var da = dustMesh.geometry.attributes.position.array;
    for(var j=0;j<dCount;j++){
      da[j*3]   += Math.sin(time*0.0003+j)*dustD[j].sx;
      da[j*3+1] += Math.cos(time*0.0002+j)*dustD[j].sy;
    }
    dustMesh.geometry.attributes.position.needsUpdate = true;

    renderer.render(scene, camera);
  }
  animate(0);

  /* Intro */
  var introTL = gsap.timeline({delay:0.3});
  introTL
    .from(spineGrp.scale, {x:0.85,y:0.85,z:0.85, duration:2.1, ease:'power2.out'})
    .from('.hero-title', {opacity:0, y:30, duration:0.7, ease:'power2.out'}, '-=1.4')
    .from('.hero-sub', {opacity:0, y:20, duration:0.6, ease:'power2.out'}, '-=0.6')
    .from('.scroll-hint', {opacity:0, duration:0.6}, '-=0.3')
    .from('.nav-dots .dot', {opacity:0, x:20, stagger:0.09, duration:0.3}, '-=0.3')
    .from('.progress-track', {opacity:0, duration:0.3}, '-=0.3');

  /* Resize */
  window.addEventListener('resize', function(){
    camera.aspect = W()/H();
    camera.updateProjectionMatrix();
    renderer.setSize(W(),H());
  });

})();
</script>
</body>
</html>